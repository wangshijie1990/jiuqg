const App = getApp();
Page({

      data: {
            // 页面参数
            options: {},
            // 页面元素
            items: {},
            scrollTop: 0,
            selectedShopId: 0,
      },

      /**
       * 生命周期函数--监听页面加载
       */
      onLoad: function (options) {
            // 当前页面参数
            this.setData({
                  options
            });
            // 加载页面数据
            
      },
      onShow:function(){
            this.getPageData();
      },
      /**
       * 加载页面数据
       */
      getPageData: function (callback) {
            let _this = this;
            App._get('page/index', {
                  page_id: _this.data.options.page_id || 0
            }, function (result) {
                  // 设置顶部导航栏栏
                  _this.setPageBar(result.data.page);
                  _this.setData(result.data);
                  // 回调函数
                  typeof callback === 'function' && callback();
            });
      },

      /**
       * 设置顶部导航栏
       */
      setPageBar: function (page) {
            // 设置页面标题
            wx.setNavigationBarTitle({
                  title: page.params.title
            });
            // 设置navbar标题、颜色
            wx.setNavigationBarColor({
                  frontColor: page.style.titleTextColor === 'white' ? '#ffffff' : '#000000',
                  backgroundColor: page.style.titleBackgroundColor
            })
      },

      /**
       * 分享当前页面
       */
      onShareAppMessage() {
            let _this = this;
            return {
                  title: _this.data.page.params.share_title,
                  path: "/pages/index/index?" + App.getShareUrlParams()
            };
      },

      /**
       * 下拉刷新
       */
      onPullDownRefresh: function () {
            // 获取首页数据
            this.getPageData(function() {
                  wx.stopPullDownRefresh();
            });
            
      },
      /*底部加载*/
      onReachBottom: function () {
            //console.log(Object.keys(this.data.items).length);

            try {
                  let m = this.selectComponent('#diy').selectComponent('#load');
                  m.load();
            }
            catch (e) {
                  //console.log(e);
            }
            //console.log(m);
            //m.load();
            //
            //diy
            //console.log(this.selectAllComponents);
            //console.log('bottom');
      }
      // /**
      //  * 返回顶部
      //  */
      // goTop: function(t) {
      //   this.setData({
      //     scrollTop: 0
      //   });
      // },

      // scroll: function(t) {
      //   this.setData({
      //     indexSearch: t.detail.scrollTop
      //   }), t.detail.scrollTop > 300 ? this.setData({
      //     floorstatus: !0
      //   }) : this.setData({
      //     floorstatus: !1
      //   });
      // },

});